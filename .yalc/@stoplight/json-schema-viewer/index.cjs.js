"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("@stoplight/json-schema-tree"),n=require("@stoplight/mosaic"),l=require("@stoplight/react-error-boundary"),r=(e=require("classnames"))&&"object"==typeof e&&"default"in e?e.default:e,a=require("react"),s=require("@fortawesome/free-solid-svg-icons"),i=require("lodash"),o=require("@stoplight/markdown-viewer"),c=require("@stoplight/json");const m=a.createContext({defaultExpandedDepth:0,viewMode:"standalone",hideExamples:!1}),u=()=>a.useContext(m),d=m.Provider;function h(e){return null!=e}const p=e=>t.isRegularNode(e)&&!!e.children&&e.children.length>0;function f(e){return!!t.isRegularNode(e)&&(!(e.primaryType!==t.SchemaNodeKind.Array||!h(e.children)||0===e.children.length)&&(1===e.children.length&&(t.isRegularNode(e.children[0])||t.isReferenceNode(e.children[0])&&null!==e.children[0].error)))}function g(e){return f(e)&&t.isRegularNode(e.children[0])&&e.children[0].simple}function v(e){return f(e)&&t.isRegularNode(e.children[0])&&!e.children[0].simple}function y(e){var n,l;return!t.isRegularNode(e)||g(e)?[]:v(e)?null!==(n=e.children[0].children)&&void 0!==n?n:[]:null!==(l=e.children)&&void 0!==l?l:[]}function N(e){var n;const{parent:l}=e;return!(null===l||!t.isRegularNode(l)||0===e.subpath.length)&&!!(null===(n=l.required)||void 0===n?void 0:n.includes(e.subpath[e.subpath.length-1]))}t.SchemaCombinerName.AllOf,t.SchemaCombinerName.AnyOf,t.SchemaCombinerName.OneOf;const E={height:12,marginTop:2,left:-25},x=({isExpanded:e})=>a.createElement("div",{className:"sl-flex sl-absolute sl-justify-center sl-items-center sl-cursor-pointer sl-text-muted",style:E,role:"button"},a.createElement(n.Icon,{size:"xs",icon:e?s.faChevronDown:s.faChevronRight})),b=({value:e})=>a.createElement(n.Box,{as:o.MarkdownViewer,markdown:e,style:{"font-size":12}}),w=({schemaNode:e})=>t.isRegularNode(e)&&null!==e.format?a.createElement("span",{className:"sl-text-muted"},`<${e.format}>`):null;function R(e){return e.primaryType===t.SchemaNodeKind.Array&&h(e.children)&&0!==e.children.length?function(e){var n,l,r;if(!h(e.children)||0===e.children.length)return e.title;if(1===e.children.length&&t.isReferenceNode(e.children[0]))return`$ref(${e.children[0].value})[]`;if(g(e)){const r=null!==(l=null===(n=e.children)||void 0===n?void 0:n.reduce((e,n)=>{if(null===e)return null;if(!t.isRegularNode(n))return null;if(null!==n.types&&n.types.length>0)for(const t of n.types)e.includes(t)||e.push(t);return e},[]))&&void 0!==l?l:null;return null!==r&&r.length>0?`array of ${r.join("s/")}s`:"array"}if(v(e)){const t=e.children[0];return t.title?`array of ${t.title}-s`:t.primaryType?`array of ${t.primaryType}s`:(null===(r=t.combiners)||void 0===r?void 0:r.length)?"array of "+t.combiners.join("/"):"array"}return null}(e):e.title}const O=({schemaNode:e})=>{var n;if(t.isReferenceNode(e))return a.createElement("span",{className:"sl-truncate"},null!==(n=e.value)&&void 0!==n?n:"$ref");if(!t.isRegularNode(e))return null;const l=function(e){return[e.types,e.combiners].reduce((e,t)=>(null===t||e.push(...t),e),[])}(e);if(0===l.length)return null;const r=l.map((n,l,{length:r})=>{var s;return a.createElement(a.Fragment,{key:n},a.createElement("span",{className:"sl-truncate sl-text-muted"},function(e){return e===t.SchemaNodeKind.Array||e===t.SchemaNodeKind.Object||"$ref"===e}(n)&&null!==(s=R(e))&&void 0!==s?s:n),l<r-1&&a.createElement("span",{key:l+"-sep",className:"sl-text-muted"}," or "))});return r.length>1?a.createElement("div",{className:"sl-truncate"},r):a.createElement(a.Fragment,null,r)};O.displayName="JsonSchemaViewer.Types";const S=["minimum","maximum","minLength","maxLength","minItems","maxItems","exclusiveMinimum","exclusiveMaximum"],k=["examples"],M=["exclusiveMinimum","exclusiveMaximum","readOnly","writeOnly"],C={minimum:e=>">= "+e,exclusiveMinimum:e=>"> "+e,minItems:e=>`>= ${e} items`,minLength:e=>`>= ${e} characters`,maximum:e=>"<= "+e,exclusiveMaximum:e=>"< "+e,maxItems:e=>`<= ${e} items`,maxLength:e=>`<= ${e} characters`},T=(e,t)=>n=>{const l=Array.isArray(n)?n:[n];return l.length?{name:(null==t?void 0:t.exact)?e:l.length>1?e+" values":e+" value",values:l.map((r=null==t?void 0:t.nowrap,e=>r&&"string"==typeof e?e:JSON.stringify(e)))}:null;var r},j={enum:T("Allowed"),examples:T("Example"),multipleOf:T("Multiple of",{exact:!0}),pattern:T("Match pattern",{exact:!0,nowrap:!0}),default:T("Default")},L={int32:{minimum:0-2**31,maximum:2**31-1},int64:{minimum:0-2**63,maximum:2**63-1},float:{minimum:0-2**128,maximum:2**128-1},double:{minimum:0-Number.MAX_VALUE,maximum:Number.MAX_VALUE},byte:{pattern:"^[\\w\\d+\\/=]*$"}};const $=({validations:e,hideExamples:t})=>{const n=i.pick(e,S),l=i.omit(i.pickBy(e,e=>["true","false"].includes(String(e))),M),r=i.omit(e,[...i.keys(n),...i.keys(l),...M,...t?k:[]]);return a.createElement(a.Fragment,null,a.createElement(A,{validations:n}),a.createElement(q,{validations:r}),a.createElement(P,{validations:l}))},A=({validations:e})=>{const t=Object.entries(e);return t.length?a.createElement(n.Flex,{my:2,color:"muted"},t.map(([e,t])=>C[e](t)).map((e,t)=>a.createElement(D,{key:t,name:e,className:"sl-mr-2"}))):null},q=({validations:e})=>a.createElement(a.Fragment,null,i.keys(e).filter(e=>Object.keys(j).includes(e)).map(t=>{const n=j[t](e[t]);return n?a.createElement(F,{key:t,name:n.name,values:n.values}):null})),F=({name:e,values:t})=>a.createElement(n.Flex,{flexWrap:!0,color:"muted",my:2},a.createElement(n.Text,{color:"light"},i.capitalize(e),":"),i.uniq(t).map(e=>a.createElement(D,{key:e,name:e,className:"sl-ml-2"}))),P=({validations:e})=>a.createElement(a.Fragment,null,i.keys(e).length?a.createElement(n.Flex,{flexWrap:!0,my:2},i.keys(e).filter(t=>e[t]).map(e=>a.createElement(D,{key:e,name:e,className:"sl-mr-2 sl-text-muted sl-capitalize"}))):null),D=({name:e,className:t})=>a.createElement(n.Text,{px:1,fontFamily:"mono",bg:"canvas-100",border:!0,rounded:"lg",className:t},e);function I(e){return Object.assign(Object.assign(Object.assign({},null!==e.enum?{enum:e.enum}:null),"annotations"in e?Object.assign(Object.assign({},e.annotations.default?{default:e.annotations.default}:null),e.annotations.examples?{examples:e.annotations.examples}:null):null),function(e){if(null!==e.format)return function(e,t){if(!(e in L))return t;const n=Object.assign({},t);for(const[t,l]of Object.entries(L[e]))l===n[t]&&delete n[t];return n}(e.format,e.validations);return e.validations}(e))}const V={paddingLeft:25},z=({childNodes:e,currentNestingLevel:t,className:l,RowComponent:r=W})=>a.createElement(n.Box,{bg:"canvas",className:l,style:V},e.map((e,l)=>a.createElement(a.Fragment,{key:e.id},l>0&&a.createElement(n.Box,{borderT:!0,borderColor:"light",alignSelf:"stretch"}),a.createElement(r,{schemaNode:e,nestingLevel:t+1})))),B=({required:e,deprecated:t,validations:{readOnly:n,writeOnly:l}})=>{const{viewMode:r}=u(),s="standalone"===r&&!!n!=!!l?n?a.createElement("span",{className:"sl-ml-2 sl-text-muted"},"read-only"):a.createElement("span",{className:"sl-ml-2 sl-text-muted"},"write-only"):null;return a.createElement(a.Fragment,null,t?a.createElement("span",{className:"sl-ml-2 sl-text-warning"},"deprecated"):null,s,e&&a.createElement("span",{className:"sl-ml-2 sl-text-warning"},"required"))};function J(e,n){const l=n?"-s":"",r=n?"s":"";if(t.isRegularNode(e)){const t=R(e);return t?t+l:null!==e.primaryType?e.primaryType+r:"any"}if(t.isReferenceNode(e)){if(e.value){const t=c.extractPointerFromRef(e.value),n=!e.error&&t?i.last(c.pointerToPath(t)):null;if("string"==typeof n)return n.split(".")[0]+l}return"$ref"+r}return"any"}function K(e,t){return{type:e,title:`${t+1}. ${J(e,!1)}`}}function _(e,t){const n=J(e,!0);return{type:e,title:`${t+1}. ${"any"!==n?"array of "+n:"array"}`}}const G=e=>{const t=a.useMemo(()=>v(e)&&p(e.children[0])&&U(e.children[0])?e.children[0].children.map(_):p(e)&&U(e)?e.children.map(K):[K(e,0)],[e]),n=t[0],[l,r]=a.useState(n);a.useEffect(()=>{r(n)},[n]);return{selectedChoice:l&&t.includes(l)?l:n,setSelectedChoice:r,choices:t}},U=e=>{var t,n;return p(e)&&["anyOf","oneOf"].includes(null!==(n=null===(t=e.combiners)||void 0===t?void 0:t[0])&&void 0!==n?n:"")},W=({schemaNode:e,nestingLevel:l})=>{const o=t.isRegularNode(e)?e.annotations.description:null,{defaultExpandedDepth:c,renderRowAddon:m,onGoToRef:d,hideExamples:h}=u(),[p,g]=a.useState(!t.isMirroredNode(e)&&l<=c),{selectedChoice:v,setSelectedChoice:E,choices:R}=G(e),S=v.type,k=a.useMemo(()=>{var n,l,r;return t.isReferenceNode(e)?e:t.isRegularNode(e)&&(f(e)||e.primaryType===t.SchemaNodeKind.Array&&1===(null===(n=e.children)||void 0===n?void 0:n.length))&&null!==(r=null===(l=e.children)||void 0===l?void 0:l.find(t.isReferenceNode))&&void 0!==r?r:null},[e]),M="string"==typeof(null==k?void 0:k.error),C=a.useMemo(()=>y(S),[S]);return a.createElement("div",{className:"sl-relative"},a.createElement("div",{className:"sl-flex"},a.createElement("div",{className:"sl-min-w-0 sl-flex-grow"},a.createElement("div",{onClick:C.length>0?()=>g(!p):void 0,className:r({"sl-cursor-pointer":C.length>0})},a.createElement("div",{className:"sl-flex sl-items-center sl-my-2"},C.length>0?a.createElement(x,{isExpanded:p}):null,a.createElement("div",{className:"sl-flex sl-items-baseline sl-text-base sl-flex-1"},e.subpath.length>0&&function(e){return 2===e.subpath.length&&("properties"===e.subpath[0]||"patternProperties"===e.subpath[0])}(e)&&a.createElement("div",{className:"sl-mr-2 sl-font-mono sl-font-semibold"},i.last(e.subpath)),1===R.length&&a.createElement(a.Fragment,null,a.createElement(O,{schemaNode:S}),a.createElement(w,{schemaNode:S})),d&&t.isReferenceNode(e)&&e.external?a.createElement("a",{className:"sl-ml-2 sl-cursor-pointer sl-text-primary-light",onClick:t=>{t.preventDefault(),t.stopPropagation(),d(e)}},"(go to ref)"):null,e.subpath.length>1&&"patternProperties"===e.subpath[0]?a.createElement("div",{className:"sl-ml-2 sl-text-muted"},"(pattern property)"):null,R.length>1&&a.createElement(n.Select,{"aria-label":"Pick a type",size:"sm",options:R.map((e,t)=>({value:String(t),label:e.title})),value:String(R.indexOf(v)),onChange:e=>E(R[e])})),a.createElement(B,{required:N(e),deprecated:t.isRegularNode(e)&&e.deprecated,validations:t.isRegularNode(e)?e.validations:{}})),"string"==typeof o&&o.length>0&&a.createElement("div",{className:"sl-flex sl-flex-1 sl-my-2 sl-text-base"},a.createElement(b,{value:o}))),a.createElement($,{validations:t.isRegularNode(e)?I(e):{},hideExamples:h}),M&&a.createElement(n.Icon,{title:k.error,color:"danger",icon:s.faExclamationTriangle,size:"sm"})),a.createElement("div",null,m?m({schemaNode:e,nestingLevel:l}):null)),C.length>0&&p?a.createElement(z,{childNodes:C,currentNestingLevel:l}):null)};const X=({schemaNode:e,nestingLevel:l})=>{const{selectedChoice:r,setSelectedChoice:i,choices:o}=G(e),c=a.useMemo(()=>y(r.type),[r.type]);return t.isRegularNode(e)&&H(e)?a.createElement(Q,null,a.createElement(z,{childNodes:c,currentNestingLevel:l})):t.isRegularNode(e)&&o.length>1?a.createElement(Q,null,a.createElement("div",{className:"sl-relative"},a.createElement(n.Select,{"aria-label":"Pick a type",size:"sm",options:o.map((e,t)=>({value:String(t),label:e.title})),value:String(o.indexOf(r)),onChange:e=>i(o[e]),renderTrigger:e=>a.createElement(n.Pressable,Object.assign({},e),a.createElement("div",{className:"sl-mr-2 sl-font-mono sl-font-semibold sl-text-base sl-flex sl-cursor-pointer sl-py-2"},r.title,a.createElement("div",{className:"sl-ml-1"},a.createElement(n.Icon,{icon:s.faCaretDown}))))}),c.length>0?a.createElement(z,{childNodes:c,currentNestingLevel:l}):null)):v(e)&&H(e.children[0])?a.createElement(Q,null,a.createElement("div",{className:"sl-relative"},a.createElement("div",{className:"sl-mr-2 sl-font-mono sl-font-semibold sl-text-base sl-py-2"},"array of:"),c.length>0?a.createElement(z,{childNodes:c,currentNestingLevel:l}):null)):a.createElement(W,{schemaNode:e,nestingLevel:l})};function H(e){var t;return"object"===e.primaryType&&1===(null===(t=e.types)||void 0===t?void 0:t.length)}const Q=({children:e})=>a.createElement("div",{style:{marginLeft:-25}},e),Y=l.withErrorBoundary(({schema:e,viewMode:l="standalone",className:s,resolveRef:i,emptyText:o="No schema defined",defaultExpandedDepth:c=2,onGoToRef:m,renderRowAddon:u,hideExamples:h})=>{const p=a.useMemo(()=>{const n=new t.SchemaTree(e,{mergeAllOf:!0,refResolver:i});return n.walker.hookInto("filter",e=>{if(!t.isRegularNode(e))return!0;const{validations:n}=e;return!!n.writeOnly==!!n.readOnly||!("read"===l&&n.writeOnly||"write"===l&&n.readOnly)}),n.populate(),n.root},[e,i,l]),f=a.useMemo(()=>p.children.every(e=>!t.isRegularNode(e)||e.unknown),[p]),g=a.useMemo(()=>({defaultExpandedDepth:c,viewMode:l,onGoToRef:m,renderRowAddon:u,hideExamples:h}),[c,l,m,u,h]);return f?a.createElement(n.Box,{className:r(s,"JsonSchemaViewer","sl-text-sm")},o):a.createElement(n.Provider,null,a.createElement(d,{value:g},a.createElement(z,{childNodes:p.children,currentNestingLevel:-1,className:r(s,"JsonSchemaViewer","sl-text-sm"),RowComponent:X})))},{FallbackComponent:({error:e})=>a.createElement(n.Box,{p:4},a.createElement("b",{className:"text-danger"},"Error"),null!==e?": "+e.message:null),recoverableProps:["schema"],reportErrors:!1});exports.JsonSchemaViewer=Y,exports.Validations=$;
//# sourceMappingURL=index.cjs.js.map
